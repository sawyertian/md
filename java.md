



### JVM

#### 类加载

class.forName("")
默认初始化，会调用静态代码块，静态字段赋值



classLoader.loadClass("") 只是把class文件加载到JVM中,不执行初始化







### 事务



#### ACID

- A 原子性 Atomicity
  指的是一个事务是一个独立的整体，要么完全操作成功，要么完全失败
- I 隔离性 isolation
  指的是并发控制的时候，事务与事务之间相互不影响，防止并发导致数据不一致，一般通过通过乐观锁和悲观锁实现
- D 持久性 durability
  指的是数据一旦提交，将永久改变数据库中的数据
- C 一致性 consistency
  事务和系统处于一致的状态
  其中一致性最不好理解，举个例子来说：一致性就是我给我同学转账100元，他如果接受到这个钱，我账户里就少了100元，而他的账户则必须要多100块，符合”守恒“，-100+100=0结果和原来没转帐之前是一样的



#### 隔离级别



- 脏读（dirty read）：两个事务，一个事务读取到了另一个事务未提交的数据，这便是脏读。

- 不可重复读:一事务对数据进行了***更新或删除***操作,另一事务两次查询的数据不一致

- 幻读（phantom read）：两个事务，事务A与事务B，事务A在自己执行的过程中，执行了两次相同查询，第一次查询事务B未提交，第二次查询事务B已提交，从而造成两次查询结果不一样，这个其实被称为不可重复读；如果事务B是一个会影响查询结果的insert操作，则好像新多出来的行像幻觉一样，因此被称为幻读。其他事务的提交会影响在同一个事务中的重复查询结果。



1. READ UNCOMMITTED (未提交读) ：隔离级别：0. 可以读取未提交的记录。会出现脏读。
2. READ COMMITTED (提交读) ：隔离级别：1. 事务中只能看到已提交的修改。不可重复读，会出现幻读。（在InnoDB中，会加行所，但是不会加间隙锁）该隔离级别是大多数数据库系统的默认隔离级别，但是MySQL的则是RR。
3. REPEATABLE READ (可重复读) ：隔离级别：2. 在InnoDB中是这样的：RR隔离级别保证对读取到的记录加锁 (记录锁)，同时保证对读取的范围加锁，新的满足查询条件的记录不能够插入 (间隙锁)，因此不存在幻读现象。但是标准的RR只能保证在同一事务中多次读取同样记录的结果是一致的，而无法解决幻读问题。InnoDB的幻读解决是依靠MVCC的实现机制做到的。
4. SERIALIZABLE （可串行化）：隔离级别：3. 该隔离级别会在读取的每一行数据上都加上锁，退化为基于锁的并发控制，即LBCC。

需要注意的是，MVCC只在RC和RR两个隔离级别下工作，其他两个隔离级别都和MVCC不兼容。

![img](https://bkimg.cdn.bcebos.com/pic/29381f30e924b89916a01fc364061d950b7bf6a9?x-bce-process=image/watermark,image_d2F0ZXIvYmFpa2U5Mg==,g_7,xp_5,yp_5/format,f_auto)







### 锁

#### 加锁机制：



##### 乐观锁

乐观锁是对于数据冲突保持一种乐观态度，操作数据时不会对操作的数据进行加锁（这使得多个任务可以并行的对数据进行操作），只有到数据提交的时候才通过一种机制来验证数据是否存在冲突(一般实现方式是通过加版本号然后进行版本号的对比方式实现);

特点：乐观锁是一种并发类型的锁，其本身不对数据进行加锁通而是通过业务实现锁的功能，不对数据进行加锁就意味着允许多个请求同时访问数据，同时也省掉了对数据加锁和解锁的过程，这种方式因为节省了悲观锁加锁的操作，所以可以一定程度的的提高操作的性能，不过在并发非常高的情况下，会导致大量的请求冲突，冲突导致大部分操作无功而返而浪费资源，所以**在高并发的场景下，乐观锁的性能却反而不如悲观锁**。



![preview](https://pic3.zhimg.com/v2-4e4f37cc8e1904713660c9036b8afe7e_r.jpg)



##### 悲观锁

顾名思义，悲观锁是基于一种悲观的态度类来防止一切数据冲突，它是以一种预防的姿态在修改数据之前把数据锁住，然后再对数据进行读写，在它释放锁之前任何人都不能对其数据进行操作，直到前面一个人把锁释放后下一个人数据加锁才可对数据进行加锁，然后才可以对数据进行操作，一般数据库本身锁的机制都是基于悲观锁的机制实现的;

特点：可以完全保证数据的独占性和正确性，因为每次请求都会先对数据进行加锁， 然后进行数据操作，最后再解锁，而加锁释放锁的过程会造成消耗，所以性能不高;

手动加悲观锁：读锁LOCK tables test_db read释放锁UNLOCK TABLES;

写锁：LOCK tables test_db WRITE释放锁UNLOCK TABLES;



![img](https://pic1.zhimg.com/80/v2-9ac6d3ccc056b289863d575fae826384_720w.jpg)





*乐观锁悲观锁是**锁的方方式***，*行锁，表锁，间隙锁是**锁的颗粒度***，共享锁，排他锁











#### MVCC

https://www.jianshu.com/p/a02fa1435169







### 数据库连接池



JNDI (Java Naming and Directory Interface,Java命名和目录接口)是SUN公司提供的一种标准的Java命名系统接口

JDBC  java数据库连接，java与数据库交互的具体执行接口，  连接池的底层也是JDBC连接



Hikari是一款非常强大，高效，并且号称“史上最快连接池”。由于其性能方面比较好，并且在springboot2.0之后，采用的默认数据库连接池就是Hikari,在引用parents后不用专门再添加依赖。



![img](https://img-blog.csdn.net/20170327155830605?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZnlzdWNjZXNz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)









